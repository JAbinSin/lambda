<!doctype html>
<html lang="en">
<head>
    <title>Lambda | History</title>

    <!-- Bootstrap 5 Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>

    <!-- The meta tags used in the webpage -->
    <!-- charset="utf-8" to use almost all the character and symbol in the world -->
    <!-- viewport to make the webpage more responsive -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Link the local css to the webpage -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/stylesheet.css') }}">  
</head>

<body class="d-grid gap-5 bg-secondary">
    <!-- Include the Navigation Bar -->
    {% include 'include/navigation-bar.html' %}

    <!-- Container for Media History and Video Feed -->
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar for History Files -->
            <div class="col-md-4 p-3 mb-2 bg-dark text-white border-dashboard" id="logs-history">
                <h2 class="text-center mb-2">History</h2>
                <div class="list-group">
                    {% for log_file in log_files %}
                        <a href="#" class="list-group-item list-group-item-action log-file" data-filename="{{ log_file }}">{{ log_file }}</a>
                    {% endfor %}
                </div>
            </div>

            <!-- Main Content for Video Feed -->
            <div class="col-md-8 p-3 mb-2 bg-dark text-white border-dashboard" id="main-content">
                <h1 class="text-center mb-2">Content</h1>
                <div class="dashboard-image-container text-center">
                    <!-- Loading circle while waiting for the video feed -->
                    <div class="spinner-border loading-circle" role="status"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const logFileLinks = document.querySelectorAll('.log-file');

            logFileLinks.forEach(link => {
                link.addEventListener('click', function(event) {
                    event.preventDefault();

                    const filename = this.getAttribute('data-filename');
                    fetchLogFileContent(filename);
                });
            });

            function fetchLogFileContent(filename) {
                fetch(`/get_log_content?filename=${filename}`)
                .then(response => response.text())
                .then(data => {
                    // Check if the data is empty
                    if (data.trim() === '') {
                        // Display "No Logs" message
                        document.getElementById('main-content').innerHTML = `<h1 class="text-center mb-2">${filename}</h1> <hr> <p class='log-content'>No History</p>`;
                    } else {
                        // Display the content in the main content area
                        document.getElementById('main-content').innerHTML = `<h1 class="text-center mb-2">${filename}</h1> <hr> <pre class='log-content'>${data}</pre>`;
                    }
                })
                .catch(error => {
                    console.error('Error fetching log file content:', error);
                });
            }
        });
    </script>
</body>
</html>
